<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <!-- Part of the open-source Proximity system (see LICENSE for
      copyright and license information). -->
      <title>Multiple Subqueries</title>
      <link rel="stylesheet" href="prox.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.71.1">
      <link rel="start" href="index.html" title="Proximity 4.3 QGraph Guide">
      <link rel="up" href="ch06.html" title="Chapter&nbsp;6.&nbsp;Subqueries">
      <link rel="prev" href="ch06s02s02.html" title="Constraints crossing the subquery boundary">
      <link rel="next" href="ch06s04.html" title="Implementation in Proximity">
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div xmlns:exsl="http://exslt.org/common" class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <td width="20%" align="left"><a accesskey="p" href="ch06s02s02.html">Prev</a>&nbsp;
               </td>
               <th width="60%" align="center">Chapter&nbsp;6.&nbsp;Subqueries</th>
               <td width="20%" align="right">&nbsp;<a accesskey="n" href="ch06s04.html">Next</a></td>
            </tr>
         </table>
         <hr>
      </div>
      <div class="sect1" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a name="subq_mult"></a>Multiple Subqueries
                  </h2>
               </div>
            </div>
         </div><a class="indexterm" name="d0e6926"></a><a class="indexterm" name="d0e6931"></a><p>You can include more than one subquery in a QGraph query.
            Because subqueries are always annotated, you must ensure that queries
            containing subqueries obey QGraph&#8217;s annotation rules.
            <a class="indexterm" name="d0e6936"></a>
            <a class="indexterm" name="d0e6942"></a>
            For example, because QGraph prohibits edges connecting two annotated
            elements, you cannot connect two subqueries by a single edge.
         </p>
         <p>In the query shown in <a href="ch06s03.html#fig_subq_badsubq02" title="Figure&nbsp;6.20.&nbsp;Illegal query">Figure&nbsp;6.20</a>,
            two subqueries are connected by the
            <em class="token">Z</em> edge.  Because the 
            <em class="token">Z</em> edge connects two annotated elements,
            this query is illegal.
            
         </p>
         <div class="figure"><a name="fig_subq_badsubq02"></a><div class="figure-contents">
               <div class="mediaobject" align="center">
                  <table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0">
                     <tr>
                        <td align="center" valign="bottom"><img src="images/SubQ_BadSubQ02.png" align="middle" width="621" alt="Illegal query"></td>
                     </tr>
                  </table>
               </div>
            </div>
            <p xmlns:exsl="http://exslt.org/common" class="title" align="center"><b>Figure&nbsp;6.20.&nbsp;Illegal query</b></p>
         </div>
         <p><br class="figure-break">
            
            It may be easier to see whether your query obeys all annotation
            rules by visualizing any subqueries
            <a class="indexterm" name="d0e6969"></a>
            as vertices. <a href="ch06s03.html#fig_subq_badsubq02B" title="Figure&nbsp;6.21.&nbsp;Conceptual structure of illegal query">Figure&nbsp;6.21</a> shows such a view
            of the above query:
            
         </p>
         <div class="figure"><a name="fig_subq_badsubq02B"></a><div class="figure-contents">
               <div class="mediaobject" align="center">
                  <table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0">
                     <tr>
                        <td align="center" valign="bottom"><img src="images/SubQ_BadSubQ02B.png" align="middle" width="328.50000000000006" alt="Conceptual structure of illegal query"></td>
                     </tr>
                  </table>
               </div>
            </div>
            <p xmlns:exsl="http://exslt.org/common" class="title" align="center"><b>Figure&nbsp;6.21.&nbsp;Conceptual structure of illegal query</b></p>
         </div>
         <p><br class="figure-break">
            Visually collapsing the subqueries into single vertices helps to
            illustrate how the <em class="token">Z</em> edge connects two
            annotated query elements.
         </p>
         <p>
            Compare the query in <a href="ch06s03.html#fig_subq_badsubq02" title="Figure&nbsp;6.20.&nbsp;Illegal query">Figure&nbsp;6.20</a> to the one
            shown below.
            
         </p>
         <div class="figure"><a name="fig_subq_badsubq02_modified"></a><div class="figure-contents">
               <div class="mediaobject" align="center">
                  <table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0">
                     <tr>
                        <td align="center" valign="bottom"><img src="images/SubQ_BadSubQ02_Modified.png" align="middle" width="630" alt="Legal query"></td>
                     </tr>
                  </table>
               </div>
            </div>
            <p xmlns:exsl="http://exslt.org/common" class="title" align="center"><b>Figure&nbsp;6.22.&nbsp;Legal query</b></p>
         </div>
         <p><br class="figure-break">
            This query adds another vertex (vertex <em class="token">E</em>)
            between the two subqueries.  Visualizing the subqueries as vertices
            yields the structure shown in 
            <a href="ch06s03.html#fig_subq_badsubq02_modifiedb" title="Figure&nbsp;6.23.&nbsp;Conceptual structure of legal query with two subqueries">Figure&nbsp;6.23</a>.
            
         </p>
         <div class="figure"><a name="fig_subq_badsubq02_modifiedb"></a><div class="figure-contents">
               <div class="mediaobject" align="center">
                  <table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0">
                     <tr>
                        <td align="center" valign="bottom"><img src="images/SubQ_BadSubQ02_ModifiedB.png" align="middle" width="413.99999999999994" alt="Conceptual structure of legal query with two subqueries"></td>
                     </tr>
                  </table>
               </div>
            </div>
            <p xmlns:exsl="http://exslt.org/common" class="title" align="center"><b>Figure&nbsp;6.23.&nbsp;Conceptual structure of legal query with two subqueries</b></p>
         </div>
         <p><br class="figure-break">
            This view helps us see that this structure obeys QGraph&#8217;s
            requirements for annotations, and is thus a legal query.
            
         </p>
         <div class="sect2" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="d0e7019"></a>Nested subqueries
                     </h3>
                  </div>
               </div>
            </div><a class="indexterm" name="idx_sub_nest1"></a><a class="indexterm" name="idx_sub_nest2"></a><a class="indexterm" name="d0e7030"></a><p>Although not yet supported by Proximity, QGraph also lets
               you nest subqueries inside other subqueries.  This further
               increases QGraph&#8217;s expressive power and lets you match
               more complex structures than would be possible with a single level of
               subquery.  The query shown in <a href="ch06s03.html#fig_subq_nested" title="Figure&nbsp;6.24.&nbsp;Nested subqueries">Figure&nbsp;6.24</a> shows
               a query that includes a nested subquery.
               
            </p>
            <div class="figure"><a name="fig_subq_nested"></a><div class="figure-contents">
                  <div class="mediaobject" align="center">
                     <table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0">
                        <tr>
                           <td align="center" valign="bottom"><img src="images/SubQ_Nested.png" align="middle" width="571.5" alt="Nested subqueries"></td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p xmlns:exsl="http://exslt.org/common" class="title" align="center"><b>Figure&nbsp;6.24.&nbsp;Nested subqueries</b></p>
            </div>
            <p><br class="figure-break">
               Nested subqueries must obey the same annotation requirements
               <a class="indexterm" name="d0e7048"></a>
               that apply to any query element.  In the above query, both the
               top-level subquery and nested subquery are annotated, as are the 
               <em class="token">X</em> and <em class="token">Y</em>
               incident
               <a class="indexterm" name="d0e7060"></a>
               edges.
            </p>
            <p>This query extends the pattern we saw in the query shown in
               <a href="ch06.html#fig_subq_db01_q01" title="Figure&nbsp;6.1.&nbsp;Example query with subquery [Intro_DB01_Q01.qg2.xml]">Figure&nbsp;6.1</a>, which returned 2d-star
               <a class="indexterm" name="d0e7070"></a>
               <a class="indexterm" name="d0e7076"></a>
               subgraphs&#8212;clusters of linked objects two hops away from a
               central object. In this case, using nested 
               subqueries lets us find and return 3d-star subgraphs.  Deeper
               nesting offers the opportunity to match even more complex structures.
               
            </p>
            <p>We can continue our technique of visualizing subqueries
               <a class="indexterm" name="d0e7082"></a>
               as vertices to help us understand more complex queries.  Visualizing
               the nested subquery in <a href="ch06s03.html#fig_subq_nested" title="Figure&nbsp;6.24.&nbsp;Nested subqueries">Figure&nbsp;6.24</a> as a single
               vertex gives us the structure shown below.
               
            </p>
            <div class="figure"><a name="fig_subq_nestedb"></a><div class="figure-contents">
                  <div class="mediaobject" align="center">
                     <table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0">
                        <tr>
                           <td align="center" valign="bottom"><img src="images/SubQ_NestedB.png" align="middle" width="423" alt="Conceptual structure of nested subqueries"></td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p xmlns:exsl="http://exslt.org/common" class="title" align="center"><b>Figure&nbsp;6.25.&nbsp;Conceptual structure of nested subqueries</b></p>
            </div>
            <p><br class="figure-break">
               
            </p>
            <p>By treating a complex structure (the nested subquery) as a vertex
               inside the top-level subquery, we can more clearly see how the structure of
               this query resembles the 2d-star query we saw in 
               <a href="ch06.html#fig_subq_db01_q01" title="Figure&nbsp;6.1.&nbsp;Example query with subquery [Intro_DB01_Q01.qg2.xml]">Figure&nbsp;6.1</a>.
               
            </p><a class="indexterm" name="d0e7103"></a><a class="indexterm" name="d0e7104"></a></div>
      </div>
      <div class="navfooter">
         <hr>
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left"><a accesskey="p" href="ch06s02s02.html">Prev</a>&nbsp;
               </td>
               <td width="20%" align="center"><a accesskey="u" href="ch06.html">Up</a></td>
               <td width="40%" align="right">&nbsp;<a accesskey="n" href="ch06s04.html">Next</a></td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top">Constraints crossing the subquery boundary&nbsp;</td>
               <td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
               <td width="40%" align="right" valign="top">&nbsp;Implementation in Proximity</td>
            </tr>
         </table>
      </div>
   </body>
</html>